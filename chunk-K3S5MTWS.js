import{Eb as l,G as i,Mc as c,T as d,Y as h,h as n,l as p,o,w as u}from"./chunk-IHZFMBYR.js";var I=(()=>{class s{http;cartItemsSubject=new n([]);cartTotalSubject=new n(0);constructor(t){this.http=t,this.loadCart()}loadCart(){this.http.get(`${c.apiUrl}/cart`).subscribe({next:t=>{let a=t.data.data||[];this.cartItemsSubject.next(a),this.updateTotal(a)},error:t=>{console.error("Error loading cart:",t),this.cartItemsSubject.next([]),this.cartTotalSubject.next(0)}})}updateTotal(t){let a=t.reduce((e,r)=>e+r.price*r.quantity,0);this.cartTotalSubject.next(a)}getCartItems(){return this.cartItemsSubject.asObservable()}addToCart(t){let a=t._id||t.id;return a?this.http.post(`${c.apiUrl}/cart`,{productId:a,quantity:1}).pipe(i(e=>{let r=e.data.data||[];this.cartItemsSubject.next(r),this.updateTotal(r)}),o(e=>e.data.data||[]),u(e=>(console.error("Error in cart request:",e),p([])))):(console.error("Cannot add product without ID:",t),p([]))}removeFromCart(t){return this.http.delete(`${c.apiUrl}/cart/${t}`).pipe(i(a=>{let e=a.data.data||[];this.cartItemsSubject.next(e),this.updateTotal(e)}),o(a=>a.data.data||[]))}updateQuantity(t,a){return this.http.patch(`${c.apiUrl}/cart/${t}`,{quantity:a}).pipe(i(e=>{let r=e.data.data||[];this.cartItemsSubject.next(r),this.updateTotal(r)}),o(e=>e.data.data||[]))}clearCart(){return this.http.delete(`${c.apiUrl}/cart`).pipe(i(t=>{this.cartItemsSubject.next([]),this.cartTotalSubject.next(0)}),o(t=>t.data.data||[]))}getTotalPrice(){return this.cartTotalSubject.asObservable()}checkout(t){return this.http.post(`${c.apiUrl}/products/order`,t).pipe(i(a=>{this.cartItemsSubject.next([]),this.cartTotalSubject.next(0)}),o(a=>a.data.data))}static \u0275fac=function(a){return new(a||s)(h(l))};static \u0275prov=d({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();export{I as a};
