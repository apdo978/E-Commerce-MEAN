import{a as A}from"./chunk-4MEGSHO6.js";import{a as z}from"./chunk-X7NW5P62.js";import{a as D,b as v,d as G,e as L,h as U,i as H,j as Y,l as $,n as J,o as ae,p as le,q as se,r as me,u as de,v as pe,w as ce,x as fe}from"./chunk-W2JZTVEG.js";import{J as ue,K as _e,L as ge,M as he,a as K,b as Q,c as W,d as X,e as Z,f as ee,g as te,h as ie,i as re,k as ne,l as oe}from"./chunk-6GY3LIXI.js";import{$a as h,Cb as O,Fb as V,Gb as T,Ha as r,Ia as i,Ja as _,L as b,M,Na as P,Nc as B,O as f,Oc as j,P as u,Pc as R,Qa as g,Rb as q,Sa as m,U as E,V as y,Z as S,_a as o,ab as I,ia as a,ja as x,jb as F,kb as k,wa as p,xa as w,ya as s,zb as N}from"./chunk-FUN73IET.js";var xe=(()=>{class t{http;constructor(e){this.http=e}updateProfile(e){return this.http.patch(`${R.apiUrl}/users/profile`,e)}static \u0275fac=function(n){return new(n||t)(S(T))};static \u0275prov=E({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Ee(t,d){if(t&1&&(r(0,"mat-card-subtitle"),o(1),F(2,"date"),i()),t&2){let e=m();a(),I("Member since ",k(2,1,e.user.iat*1e3),"")}}function ye(t,d){t&1&&(r(0,"div",9),_(1,"mat-spinner",10),i())}function Se(t,d){if(t&1&&(r(0,"div",14)(1,"div",15)(2,"h3"),o(3,"Name"),i(),r(4,"p"),o(5),i()(),r(6,"div",15)(7,"h3"),o(8,"Email"),i(),r(9,"p"),o(10),i()(),r(11,"div",16)(12,"h3"),o(13,"User Type"),i(),r(14,"p"),o(15),i()()()),t&2){let e=m(2);a(5),h(e.user==null?null:e.user.name),a(5),h(e.user==null?null:e.user.email),a(5),h(e.getUserTypeName(e.user==null?null:e.user.userType))}}function Ie(t,d){t&1&&(r(0,"mat-error"),o(1,"Name is required"),i())}function Fe(t,d){t&1&&(r(0,"mat-error"),o(1,"Email is required"),i())}function ke(t,d){t&1&&(r(0,"mat-error"),o(1,"Please enter a valid email address"),i())}function Ne(t,d){t&1&&(r(0,"mat-error"),o(1," Current password is required to make changes "),i())}function Oe(t,d){t&1&&(r(0,"mat-error"),o(1," Password must be at least 6 characters "),i())}function Ve(t,d){if(t&1){let e=P();r(0,"form",17)(1,"mat-form-field",18)(2,"mat-label"),o(3,"Name"),i(),_(4,"input",19),p(5,Ie,2,0,"mat-error",3),i(),r(6,"mat-form-field",18)(7,"mat-label"),o(8,"Email"),i(),_(9,"input",20),p(10,Fe,2,0,"mat-error",3)(11,ke,2,0,"mat-error",3),i(),r(12,"mat-form-field",18)(13,"mat-label"),o(14,"Current Password"),i(),_(15,"input",21),r(16,"button",22),g("click",function(){f(e);let l=m(2);return u(l.togglePasswordVisibility("password"))}),r(17,"mat-icon"),o(18),i()(),p(19,Ne,2,0,"mat-error",3),i(),r(20,"mat-form-field",18)(21,"mat-label"),o(22,"New Password"),i(),_(23,"input",23),r(24,"button",22),g("click",function(){f(e);let l=m(2);return u(l.togglePasswordVisibility("newPassword"))}),r(25,"mat-icon"),o(26),i()(),r(27,"mat-hint"),o(28,"Leave blank to keep current password"),i(),p(29,Oe,2,0,"mat-error",3),i()()}if(t&2){let e=m(2),n,l,c,C;s("formGroup",e.profileForm),a(5),s("ngIf",(n=e.profileForm.get("name"))==null?null:n.hasError("required")),a(5),s("ngIf",(l=e.profileForm.get("email"))==null?null:l.hasError("required")),a(),s("ngIf",(c=e.profileForm.get("email"))==null?null:c.hasError("email")),a(4),s("type",e.hidePassword?"password":"text"),a(),w("aria-label","Hide password")("aria-pressed",e.hidePassword),a(2),h(e.hidePassword?"visibility_off":"visibility"),a(),s("ngIf",e.profileForm.errors==null?null:e.profileForm.errors.passwordRequired),a(4),s("type",e.hideNewPassword?"password":"text"),a(),w("aria-label","Hide password")("aria-pressed",e.hideNewPassword),a(2),h(e.hideNewPassword?"visibility_off":"visibility"),a(3),s("ngIf",(C=e.profileForm.get("newPassword"))==null?null:C.hasError("minlength"))}}function Te(t,d){if(t&1&&(r(0,"div",11),p(1,Se,16,3,"div",12)(2,Ve,30,14,"form",13),i()),t&2){let e=m();a(),s("ngIf",!e.isEditing),a(),s("ngIf",e.isEditing)}}function qe(t,d){if(t&1){let e=P();r(0,"button",24),g("click",function(){f(e);let l=m();return u(l.toggleEdit())}),o(1," CANCEL "),i()}if(t&2){let e=m();s("disabled",e.loading)}}function Be(t,d){if(t&1){let e=P();r(0,"button",25),g("click",function(){f(e);let l=m();return u(l.toggleEdit())}),o(1," EDIT PROFILE "),i()}if(t&2){let e=m();s("disabled",e.loading)}}function je(t,d){if(t&1){let e=P();r(0,"button",25),g("click",function(){f(e);let l=m();return u(l.saveProfile())}),o(1," SAVE "),i()}if(t&2){let e=m();s("disabled",e.profileForm.invalid||e.loading)}}var Pe=(()=>{class t{fb;profileService;authService;snackBar;profileForm;user=null;loading=!1;isEditing=!1;hidePassword=!0;hideNewPassword=!0;constructor(e,n,l,c){this.fb=e,this.profileService=n,this.authService=l,this.snackBar=c,this.profileForm=this.fb.group({name:["",[v.required,v.minLength(3)]],email:["",[v.required,v.email]],password:[""],newPassword:["",[v.minLength(6)]]},{validators:this.passwordValidator})}ngOnInit(){this.loading=!0,this.authService.currentUser$.subscribe(e=>{e&&(this.user=e,this.profileForm.patchValue({name:e.name||"",email:e.email||"",password:"",newPassword:""})),this.loading=!1})}toggleEdit(){this.isEditing=!this.isEditing,!this.isEditing&&this.user&&this.profileForm.patchValue({name:this.user.name||"",email:this.user.email||"",password:"",newPassword:""})}saveProfile(){if(this.profileForm.invalid){this.profileForm.errors?.passwordRequired?this.snackBar.open("Current password is required to make changes","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}):this.snackBar.open("Please fill in all required fields correctly","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"});return}let e={name:this.profileForm.get("name")?.value,email:this.profileForm.get("email")?.value,password:this.profileForm.get("password")?.value,newPassword:this.profileForm.get("newPassword")?.value};this.loading=!0,this.profileService.updateProfile(e).subscribe({next:n=>{this.snackBar.open("Profile updated successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isEditing=!1,this.loading=!1,n.data?.user&&this.user&&(this.user.name=n.data.user.name||this.user.name,this.user.email=n.data.user.email||this.user.email,console.log(n),this.authService.updateUserData(n))},error:n=>{this.snackBar.open(n.error?.data.message||"Failed to update profile","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.loading=!1}})}togglePasswordVisibility(e){e==="password"?this.hidePassword=!this.hidePassword:this.hideNewPassword=!this.hideNewPassword}passwordValidator(e){let n=e.get("password")?.value,l=e.get("newPassword")?.value,c=e.get("name")?.value,C=e.get("email")?.value,we=e?.parent?.get("user")?.value?.name,be=e?.parent?.get("user")?.value?.email;return(c!==we||C!==be||l)&&!n?(e.get("password")?.setErrors({required:!0}),{passwordRequired:!0}):null}getUserTypeName(e){return!e||typeof e=="string"?"Standard":e.name||"Standard"}static \u0275fac=function(n){return new(n||t)(x($),x(xe),x(z),x(ue))};static \u0275cmp=b({type:t,selectors:[["app-profile"]],decls:16,vars:6,consts:[[1,"profile-container"],[1,"profile-card"],["mat-card-avatar","",1,"profile-avatar"],[4,"ngIf"],["class","loading-spinner",4,"ngIf"],["class","profile-content",4,"ngIf"],["align","end"],["mat-button","",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",3,"disabled","click",4,"ngIf"],[1,"loading-spinner"],["diameter","50"],[1,"profile-content"],["class","profile-info",4,"ngIf"],["class","profile-form",3,"formGroup",4,"ngIf"],[1,"profile-info"],[1,"info-group"],[1,"user-type"],[1,"profile-form",3,"formGroup"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Your name"],["matInput","","formControlName","email","placeholder","Your email","type","email"],["matInput","","formControlName","password","placeholder","Required for any changes",3,"type"],["mat-icon-button","","matSuffix","",3,"click"],["matInput","","formControlName","newPassword","placeholder","Enter new password",3,"type"],["mat-button","",3,"disabled","click"],["mat-raised-button","","color","primary",3,"disabled","click"]],template:function(n,l){n&1&&(r(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"div",2)(4,"mat-icon"),o(5,"account_circle"),i()(),r(6,"mat-card-title"),o(7,"My Profile"),i(),p(8,Ee,3,3,"mat-card-subtitle",3),i(),r(9,"mat-card-content"),p(10,ye,2,0,"div",4)(11,Te,3,2,"div",5),i(),r(12,"mat-card-actions",6),p(13,qe,2,1,"button",7)(14,Be,2,1,"button",8)(15,je,2,1,"button",8),i()()()),n&2&&(a(8),s("ngIf",l.user),a(2),s("ngIf",l.loading),a(),s("ngIf",!l.loading),a(2),s("ngIf",l.isEditing),a(),s("ngIf",!l.isEditing),a(),s("ngIf",l.isEditing))},dependencies:[N,U,D,G,L,H,Y,K,Q,ce,de,ae,se,le,me,X,ie,ne,ee,re,te,Z,B,ge,O],styles:[".profile-container[_ngcontent-%COMP%]{max-width:800px;margin:2rem auto;padding:0 1rem}.profile-card[_ngcontent-%COMP%]{box-shadow:0 4px 12px #0000001a;border-radius:8px}.profile-avatar[_ngcontent-%COMP%]{background-color:#007bff;display:flex;align-items:center;justify-content:center}.profile-avatar[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#fff;font-size:40px;height:40px;width:40px}.profile-content[_ngcontent-%COMP%]{margin-top:1rem;min-height:250px}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:3rem 0}.profile-info[_ngcontent-%COMP%]   .info-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.profile-info[_ngcontent-%COMP%]   .info-group[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#666;margin-bottom:.5rem}.profile-info[_ngcontent-%COMP%]   .info-group[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;color:#333;margin:0}.profile-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:1rem}.profile-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%;margin-bottom:1rem}mat-card-actions[_ngcontent-%COMP%]{padding:1rem}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:.5rem}.mat-icon[_ngcontent-%COMP%]{cursor:pointer}.mat-hint[_ngcontent-%COMP%]{font-size:.8rem;color:#0009}"]})}return t})();var Ce=[{path:"",component:Pe,canActivate:[A]}];var _t=(()=>{class t{static \u0275fac=function(n){return new(n||t)};static \u0275mod=M({type:t});static \u0275inj=y({imports:[V,q.forChild(Ce),J,W,fe,pe,oe,j,_e,he]})}return t})();export{_t as ProfileModule};
