import{Eb as g,G as i,Mc as a,T as d,Y as h,a as u,b as l,h as p,o as n}from"./chunk-IHZFMBYR.js";var b=(()=>{class o{http;currentUserSubject=new p(null);currentUser$=this.currentUserSubject.asObservable();TOKEN_KEY="auth_token";constructor(e){this.http=e,this.loadStoredUser()}loadStoredUser(){let e=localStorage.getItem(this.TOKEN_KEY);if(e){let t=this.decodeToken(e);this.currentUserSubject.next(t)}}login(e,t){return this.http.post(`${a.apiUrl}/users/login`,{email:e,password:t}).pipe(i(r=>{let s=r.data.data;if(s){localStorage.setItem(this.TOKEN_KEY,s);let c=this.decodeToken(s);this.currentUserSubject.next(c)}}),n(r=>({token:r.data.data})))}register(e){return this.http.post(`${a.apiUrl}/users/InsertUserS`,e).pipe(n(t=>t.data.data))}getAllUsers(){let e=this.currentUserSubject.value,r={ObjectId:typeof e?.userType=="object"?e?.userType?._id:e?.userType?.toString()||""};return this.http.get(`${a.apiUrl}/users/GetAllUserS`,{params:r}).pipe(i(s=>console.log("API Response:",s)),n(s=>s.data.data))}editUser(e,t){return console.log(t),this.http.patch(`${a.apiUrl}/users/EditUsers`,l(u({},t),{userId:e})).pipe(n(r=>r.data.data))}logout(){localStorage.removeItem(this.TOKEN_KEY),this.currentUserSubject.next(null)}isAuthenticated(){return!!this.getToken()}getToken(){return localStorage.getItem(this.TOKEN_KEY)}decodeToken(e){try{let r=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(r).split("").map(U=>"%"+("00"+U.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(s)}catch(t){return console.error("Error decoding token:",t),{}}}isAdmin(){let e=this.currentUserSubject.value;return!e||!e.userType?!1:!!e.userType}static \u0275fac=function(t){return new(t||o)(h(g))};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();export{b as a};
