import{Gb as h,H as i,Qc as a,U as d,Z as p,a as u,i as l,p as n}from"./chunk-SVQ5KEBI.js";var f=(()=>{class o{http;currentUserSubject=new l(null);currentUser$=this.currentUserSubject.asObservable();TOKEN_KEY="auth_token";constructor(e){this.http=e,this.loadStoredUser()}loadStoredUser(){let e=localStorage.getItem(this.TOKEN_KEY);if(e){let t=this.decodeToken(e);this.currentUserSubject.next(t)}}login(e,t){return this.http.post(`${a.apiUrl}/users/login`,{email:e,password:t}).pipe(i(s=>{let r=s.data.data;if(r){localStorage.setItem(this.TOKEN_KEY,r);let c=this.decodeToken(r);this.currentUserSubject.next(c)}}),n(s=>({token:s.data.data})))}register(e){return this.http.post(`${a.apiUrl}/users/InsertUserS`,e).pipe(n(t=>t.data.data))}getAllUsers(){let e=this.currentUserSubject.value,s={ObjectId:typeof e?.userType=="object"?e?.userType?._id:e?.userType?.toString()||""};return this.http.get(`${a.apiUrl}/users/GetAllUserS`,{params:s}).pipe(i(r=>console.log("API Response:",r)),n(r=>r.data.data))}editUser(e){return this.http.patch(`${a.apiUrl}/users/EditUsers`,u({},e)).pipe(n(t=>t.data.data))}logout(){localStorage.removeItem(this.TOKEN_KEY),this.currentUserSubject.next(null)}isAuthenticated(){return!!this.getToken()}getToken(){return localStorage.getItem(this.TOKEN_KEY)}decodeToken(e){try{let s=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(s).split("").map(g=>"%"+("00"+g.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(r)}catch(t){return console.error("Error decoding token:",t),{}}}isAdmin(){let e=this.currentUserSubject.value;return!e||!e.userType?!1:!!e.userType}updateUserData(e){if(e.data?.token){localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.setItem(this.TOKEN_KEY,e.data.token);let t=this.decodeToken(e.data.token);this.currentUserSubject.next(t)}}OauthLogin(e){if(e){localStorage.setItem(this.TOKEN_KEY,e);let t=this.decodeToken(e);this.currentUserSubject.next(t)}}static \u0275fac=function(t){return new(t||o)(p(h))};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();export{f as a};
